WARNING: The requested image's platform (linux/amd64) does not match the detected host platform (linux/arm64/v8) and no specific platform was requested
INFO Parameters: {
  "app_instance_name": "apptest-6h847sl3",
  "namespace": "apptest-6h847sl3"
}
INFO Creates namespace "apptest-6h847sl3"
Using /opt/kubectl/default/kubectl (server=1.21)
namespace/apptest-6h847sl3 created
INFO Initializes the deployer container which will deploy all the application components
WARNING: The requested image's platform (linux/amd64) does not match the detected host platform (linux/arm64/v8) and no specific platform was requested
INFO: /data/schema.yaml:
x-google-marketplace:
  schemaVersion: v2
  applicationApiVersion: v1beta1
  # The published version is required and MUST match the tag
  # of the deployer image
  publishedVersion: '0.0.1'
  publishedVersionMetadata:
    releaseNote: >-
      A first release.
  images:
    '': # primary image
      properties:
        imageRepo:
          type: REPO_WITH_REGISTRY
        imageTag:
          type: TAG
properties:
  app_instance_name:
    type: string
    default: entitlement
    x-google-marketplace:
      type: NAME
  namespace:
    type: string
    x-google-marketplace:
      type: NAMESPACE
  is_codelab:
    type: boolean
    default: false
  marketplace_project:
    type: string
  backend_project:
    type: string
  log_level:
    type: string
    default: info
  slack_webhook:
    type: string
  event_topic:
    type: string
  subscription_id:
    type: string
  deployment_service_account:
    type: string
    x-google-marketplace:
      type: SERVICE_ACCOUNT
      serviceAccount:
        description: The kubernetes service account that will run the deployments. Bound to "google_service_account_email" via Workload Identity
  google_service_account_email:
    type: string
    description: The google service account with permissions to access the procurement API. Bound to "deployment_service_account" via Workload Identity
required:
- app_instance_name
- namespace
- is_codelab
- marketplace_project
- backend_project
- log_level
- slack_webhook
- event_topic
- subscription_id
- google_service_account_emailUsing /opt/kubectl/default/kubectl (server=1.21)
Using /opt/kubectl/default/kubectl (server=1.21)
application.app.k8s.io/apptest-6h847sl3 created
Using /opt/kubectl/default/kubectl (server=1.21)
Using /opt/kubectl/default/kubectl (server=1.21)
serviceaccount/apptest-6h847sl3-deployer-sa created
Using /opt/kubectl/default/kubectl (server=1.21)
INFO Application 'apptest-6h847sl3' owns 'ServiceAccount/apptest-6h847sl3-deploymentserviceaccount'
INFO Application 'apptest-6h847sl3' owns 'ServiceAccount/apptest-6h847sl3-deployer-sa'
INFO Application 'apptest-6h847sl3' owns 'Secret/apptest-6h847sl3-deployer-config'
INFO Application 'apptest-6h847sl3' owns 'Job/apptest-6h847sl3-deployer'
INFO Application 'apptest-6h847sl3' owns 'RoleBinding/apptest-6h847sl3-deployer-rb'
INFO: Applying the following manifests:
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app.kubernetes.io/component: auto-provisioned.marketplace.cloud.google.com
    app.kubernetes.io/name: apptest-6h847sl3
    marketplace.cloud.google.com/auto-provisioned-for-property: deployment_service_account
  name: apptest-6h847sl3-deploymentserviceaccount
  namespace: apptest-6h847sl3
  ownerReferences:
  - apiVersion: app.k8s.io/v1beta1
    blockOwnerDeletion: true
    kind: Application
    name: apptest-6h847sl3
    uid: a66a1df5-2d0c-486f-8fb4-467e7d149db3
---
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app.kubernetes.io/component: deployer.marketplace.cloud.google.com
    app.kubernetes.io/name: apptest-6h847sl3
    marketplace.cloud.google.com/deployer: Dependent
  name: apptest-6h847sl3-deployer-sa
  namespace: apptest-6h847sl3
  ownerReferences:
  - apiVersion: app.k8s.io/v1beta1
    blockOwnerDeletion: true
    kind: Application
    name: apptest-6h847sl3
    uid: a66a1df5-2d0c-486f-8fb4-467e7d149db3
---
apiVersion: v1
kind: Secret
metadata:
  labels:
    app.kubernetes.io/component: deployer.marketplace.cloud.google.com
    app.kubernetes.io/name: apptest-6h847sl3
    marketplace.cloud.google.com/deployer: Dependent
  name: apptest-6h847sl3-deployer-config
  namespace: apptest-6h847sl3
  ownerReferences:
  - apiVersion: app.k8s.io/v1beta1
    blockOwnerDeletion: true
    kind: Application
    name: apptest-6h847sl3
    uid: a66a1df5-2d0c-486f-8fb4-467e7d149db3
stringData:
  values.yaml: '__image_repo_prefix__: gcr.io/doit-public/doit-easily

    app_instance_name: apptest-6h847sl3

    deployment_service_account: apptest-6h847sl3-deploymentserviceaccount

    namespace: apptest-6h847sl3

    '
type: Opaque
---
apiVersion: batch/v1
kind: Job
metadata:
  labels:
    app.kubernetes.io/component: deployer.marketplace.cloud.google.com
    app.kubernetes.io/name: apptest-6h847sl3
    marketplace.cloud.google.com/deployer: Main
  name: apptest-6h847sl3-deployer
  namespace: apptest-6h847sl3
  ownerReferences:
  - apiVersion: app.k8s.io/v1beta1
    blockOwnerDeletion: true
    kind: Application
    name: apptest-6h847sl3
    uid: a66a1df5-2d0c-486f-8fb4-467e7d149db3
spec:
  backoffLimit: 0
  template:
    metadata:
      annotations:
        sidecar.istio.io/inject: 'false'
    spec:
      containers:
      - command:
        - /bin/deploy_with_tests.sh
        image: gcr.io/doit-public/doit-easily/deployer:0.1
        imagePullPolicy: Always
        name: deployer
        resources:
          requests:
            cpu: 100m
            memory: 100Mi
        volumeMounts:
        - mountPath: /data/values.yaml
          name: config-volume
          readOnly: true
          subPath: values.yaml
      restartPolicy: Never
      serviceAccountName: apptest-6h847sl3-deployer-sa
      volumes:
      - name: config-volume
        secret:
          secretName: apptest-6h847sl3-deployer-config
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  labels:
    app.kubernetes.io/component: deployer-rbac.marketplace.cloud.google.com
    app.kubernetes.io/name: apptest-6h847sl3
    marketplace.cloud.google.com/deployer: Dependent
  name: apptest-6h847sl3-deployer-rb
  namespace: apptest-6h847sl3
  ownerReferences:
  - apiVersion: app.k8s.io/v1beta1
    blockOwnerDeletion: true
    kind: Application
    name: apptest-6h847sl3
    uid: a66a1df5-2d0c-486f-8fb4-467e7d149db3
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cluster-admin
subjects:
- kind: ServiceAccount
  name: apptest-6h847sl3-deployer-sa
  namespace: apptest-6h847sl3
Using /opt/kubectl/default/kubectl (server=1.21)
serviceaccount/apptest-6h847sl3-deploymentserviceaccount created
serviceaccount/apptest-6h847sl3-deployer-sa configured
secret/apptest-6h847sl3-deployer-config created
job.batch/apptest-6h847sl3-deployer created
rolebinding.rbac.authorization.k8s.io/apptest-6h847sl3-deployer-rb created
INFO wait for the deployer to succeed
Using /opt/kubectl/default/kubectl (server=1.21)
Elapsed 2sUsing /opt/kubectl/default/kubectl (server=1.21)
Elapsed 8sUsing /opt/kubectl/default/kubectl (server=1.21)
Elapsed 14sUsing /opt/kubectl/default/kubectl (server=1.21)
Elapsed 20sUsing /opt/kubectl/default/kubectl (server=1.21)
Elapsed 26sUsing /opt/kubectl/default/kubectl (server=1.21)
Elapsed 32sUsing /opt/kubectl/default/kubectl (server=1.21)
Elapsed 38sUsing /opt/kubectl/default/kubectl (server=1.21)
Elapsed 43sUsing /opt/kubectl/default/kubectl (server=1.21)
Elapsed 49sUsing /opt/kubectl/default/kubectl (server=1.21)
Elapsed 55sUsing /opt/kubectl/default/kubectl (server=1.21)
Elapsed 61sUsing /opt/kubectl/default/kubectl (server=1.21)
Elapsed 67sUsing /opt/kubectl/default/kubectl (server=1.21)
Elapsed 73sUsing /opt/kubectl/default/kubectl (server=1.21)
Elapsed 79sUsing /opt/kubectl/default/kubectl (server=1.21)
Elapsed 86sUsing /opt/kubectl/default/kubectl (server=1.21)
Elapsed 94sUsing /opt/kubectl/default/kubectl (server=1.21)
Elapsed 103sUsing /opt/kubectl/default/kubectl (server=1.21)
Elapsed 109sUsing /opt/kubectl/default/kubectl (server=1.21)
Elapsed 115sUsing /opt/kubectl/default/kubectl (server=1.21)
Elapsed 121sUsing /opt/kubectl/default/kubectl (server=1.21)
Elapsed 127sUsing /opt/kubectl/default/kubectl (server=1.21)
Elapsed 133sUsing /opt/kubectl/default/kubectl (server=1.21)
Elapsed 139sUsing /opt/kubectl/default/kubectl (server=1.21)
Elapsed 145sUsing /opt/kubectl/default/kubectl (server=1.21)
Elapsed 151sUsing /opt/kubectl/default/kubectl (server=1.21)
INFO Deployer job succeeded
Using /opt/kubectl/default/kubectl (server=1.21)
+ trap handle_failure EXIT
+ LOG_SMOKE_TEST=SMOKE_TEST
+ test_schema=/data-test/schema.yaml
+ overlay_test_schema.py --test_schema /data-test/schema.yaml --original_schema /data/schema.yaml --output /data/schema.yaml
++ /bin/print_config.py --xtype NAME --values_mode raw
+ NAME=apptest-6h847sl3
++ /bin/print_config.py --xtype NAMESPACE --values_mode raw
+ NAMESPACE=apptest-6h847sl3
+ export NAME
+ export NAMESPACE
+ echo 'Deploying application "apptest-6h847sl3" in test mode'
Deploying application "apptest-6h847sl3" in test mode
++ kubectl get applications.app.k8s.io/apptest-6h847sl3 --namespace=apptest-6h847sl3 '--output=jsonpath={.metadata.uid}'
Using /opt/kubectl/1.21/kubectl (server=1.21)
+ app_uid=a66a1df5-2d0c-486f-8fb4-467e7d149db3
++ kubectl get applications.app.k8s.io/apptest-6h847sl3 --namespace=apptest-6h847sl3 '--output=jsonpath={.apiVersion}'
Using /opt/kubectl/1.21/kubectl (server=1.21)
+ app_api_version=app.k8s.io/v1beta1
++ kubectl get namespaces/apptest-6h847sl3 '--output=jsonpath={.metadata.uid}'
Using /opt/kubectl/1.21/kubectl (server=1.21)
+ namespace_uid=8c367162-f321-45be-a830-9b4769210c98
+ /bin/expand_config.py --values_mode raw --app_uid a66a1df5-2d0c-486f-8fb4-467e7d149db3
+ create_manifests.sh --mode=test
+ for i in '"$@"'
+ case $i in
+ mode=test
+ shift
+ [[ -z apptest-6h847sl3 ]]
+ [[ -z apptest-6h847sl3 ]]
++ /bin/print_config.py -o shell_vars
+ env_vars='$app_instance_name $backend_project $deployment_service_account $event_topic $google_service_account_email $imageRepo $imageTag $is_codelab $log_level $marketplace_project $namespace $slack_webhook $subscription_id $testerImage'
+ echo 'Creating the manifests for the kubernetes resources that build the application "apptest-6h847sl3"'
+ data_dir=/data
+ manifest_dir=/data/manifest-expanded
+ mkdir /data/manifest-expanded
Creating the manifests for the kubernetes resources that build the application "apptest-6h847sl3"
+ [[ test = \t\e\s\t ]]
+ [[ -e /data-test/manifest ]]
+ cp -RT /data-test/manifest /data/manifest
+ for manifest_template_file in '"$data_dir"/manifest/*'
++ basename /data/manifest/application.yaml.template
++ sed 's/.template$//'
+ manifest_file=application.yaml
+ cat /data/manifest/application.yaml.template
+ /bin/config_env.py envsubst '$app_instance_name $backend_project $deployment_service_account $event_topic $google_service_account_email $imageRepo $imageTag $is_codelab $log_level $marketplace_project $namespace $slack_webhook $subscription_id $testerImage'
+ ensure_k8s_apps_labels.py --manifest /data/manifest-expanded/application.yaml --appname apptest-6h847sl3
INFO Reading /data/manifest-expanded/application.yaml
+ for manifest_template_file in '"$data_dir"/manifest/*'
++ basename /data/manifest/manifests.yaml.template
++ sed 's/.template$//'
+ manifest_file=manifests.yaml
+ cat /data/manifest/manifests.yaml.template
+ /bin/config_env.py envsubst '$app_instance_name $backend_project $deployment_service_account $event_topic $google_service_account_email $imageRepo $imageTag $is_codelab $log_level $marketplace_project $namespace $slack_webhook $subscription_id $testerImage'
+ ensure_k8s_apps_labels.py --manifest /data/manifest-expanded/manifests.yaml --appname apptest-6h847sl3
INFO Reading /data/manifest-expanded/manifests.yaml
+ for manifest_template_file in '"$data_dir"/manifest/*'
++ basename /data/manifest/tester.yaml
++ sed 's/.template$//'
+ manifest_file=tester.yaml
+ cat /data/manifest/tester.yaml
+ /bin/config_env.py envsubst '$app_instance_name $backend_project $deployment_service_account $event_topic $google_service_account_email $imageRepo $imageTag $is_codelab $log_level $marketplace_project $namespace $slack_webhook $subscription_id $testerImage'
+ ensure_k8s_apps_labels.py --manifest /data/manifest-expanded/tester.yaml --appname apptest-6h847sl3
INFO Reading /data/manifest-expanded/tester.yaml
+ /bin/set_ownership.py --app_name apptest-6h847sl3 --app_uid a66a1df5-2d0c-486f-8fb4-467e7d149db3 --app_api_version app.k8s.io/v1beta1 --namespace apptest-6h847sl3 --namespace_uid 8c367162-f321-45be-a830-9b4769210c98 --manifests /data/manifest-expanded --dest /data/resources.yaml
INFO Reading /data/manifest-expanded/tester.yaml
INFO Reading /data/manifest-expanded/application.yaml
INFO Reading /data/manifest-expanded/manifests.yaml
INFO Application 'apptest-6h847sl3' owns 'ServiceAccount/apptest-6h847sl3-deploymentserviceaccount'
INFO Application 'apptest-6h847sl3' owns 'Deployment/apptest-6h847sl3-server'
INFO Application 'apptest-6h847sl3' owns 'Service/apptest-6h847sl3-api'
INFO Application 'apptest-6h847sl3' owns 'Deployment/apptest-6h847sl3-processor'
+ validate_app_resource.py --manifests /data/resources.yaml
INFO Reading /data/resources.yaml
+ separate_tester_resources.py --app_uid a66a1df5-2d0c-486f-8fb4-467e7d149db3 --app_name apptest-6h847sl3 --app_api_version app.k8s.io/v1beta1 --manifests /data/resources.yaml --out_manifests /data/resources.yaml --out_test_manifests /data/tester.yaml
INFO Reading /data/resources.yaml
INFO Tester resource: Pod/apptest-6h847sl3-tester
INFO Prod resource: Application/apptest-6h847sl3
INFO Prod resource: ServiceAccount/apptest-6h847sl3-deploymentserviceaccount
INFO Prod resource: Deployment/apptest-6h847sl3-server
INFO Prod resource: Service/apptest-6h847sl3-api
INFO Prod resource: Deployment/apptest-6h847sl3-processor
+ kubectl apply --namespace=apptest-6h847sl3 --filename=/data/resources.yaml
Using /opt/kubectl/1.21/kubectl (server=1.21)
application.app.k8s.io/apptest-6h847sl3 configured
serviceaccount/apptest-6h847sl3-deploymentserviceaccount configured
Warning: Autopilot increased resource requests for Deployment apptest-6h847sl3/apptest-6h847sl3-server to meet requirements. See http://g.co/gke/autopilot-resources.
deployment.apps/apptest-6h847sl3-server created
service/apptest-6h847sl3-api created
deployment.apps/apptest-6h847sl3-processor created
Warning: Autopilot increased resource requests for Deployment apptest-6h847sl3/apptest-6h847sl3-processor to meet requirements. See http://g.co/gke/autopilot-resources.
+ patch_assembly_phase.sh --status=Success
+ for i in '"$@"'
+ case $i in
+ status=Success
+ shift
+ [[ -z Success ]]
+ [[ Success =~ ^(Pending|Success|Failed)$ ]]
+ [[ -z apptest-6h847sl3 ]]
+ [[ -z apptest-6h847sl3 ]]
+ echo 'Marking deployment of application "apptest-6h847sl3" as "Success".'
+ [[ Success == \S\u\c\c\e\s\s ]]
++ print_published_version.py --empty_if_not_supported
Marking deployment of application "apptest-6h847sl3" as "Success".
+ published_version=0.0.1
+ [[ -z 0.0.1 ]]
++ kubectl get applications.app.k8s.io/apptest-6h847sl3 --output=json
++ jq -r .spec.descriptor.version
Using /opt/kubectl/1.21/kubectl (server=1.21)
+ app_version=0.0.1
+ [[ 0.0.1 != \0\.\0\.\1 ]]
+ kubectl patch applications.app.k8s.io/apptest-6h847sl3 --output=json --namespace=apptest-6h847sl3 --type=merge --patch '{"spec": {"assemblyPhase": "Success"}}'
Using /opt/kubectl/1.21/kubectl (server=1.21)
{
    "apiVersion": "app.k8s.io/v1beta1",
    "kind": "Application",
    "metadata": {
        "annotations": {
            "kubectl.kubernetes.io/last-applied-configuration": "{\"apiVersion\":\"app.k8s.io/v1beta1\",\"kind\":\"Application\",\"metadata\":{\"annotations\":{\"marketplace.cloud.google.com/deploy-info\":\"{\\\"partner_id\\\": \\\"click-to-deploy-containers\\\", \\\"product_id\\\": \\\"doit-easily\\\", \\\"partner_name\\\": \\\"Google Click to Deploy\\\"}\"},\"labels\":{\"app.kubernetes.io/name\":\"apptest-6h847sl3\"},\"name\":\"apptest-6h847sl3\",\"namespace\":\"apptest-6h847sl3\"},\"spec\":{\"componentKinds\":[{\"group\":\"apps\",\"kind\":\"Deployment\"},{\"group\":\"\",\"kind\":\"Service\"},{\"group\":\"\",\"kind\":\"ServiceAccount\"}],\"descriptor\":{\"description\":\"A description of this application. A marketplace backend integration solution.\",\"type\":\"DoiT Easily\",\"version\":\"0.0.1\"},\"selector\":{\"matchLabels\":{\"app.kubernetes.io/name\":\"apptest-6h847sl3\"}}}}\n",
            "marketplace.cloud.google.com/deploy-info": "{\"partner_id\": \"click-to-deploy-containers\", \"product_id\": \"doit-easily\", \"partner_name\": \"Google Click to Deploy\"}"
        },
        "creationTimestamp": "2022-04-22T16:51:58Z",
        "generation": 3,
        "labels": {
            "app.kubernetes.io/name": "apptest-6h847sl3"
        },
        "name": "apptest-6h847sl3",
        "namespace": "apptest-6h847sl3",
        "resourceVersion": "5644547",
        "uid": "a66a1df5-2d0c-486f-8fb4-467e7d149db3"
    },
    "spec": {
        "assemblyPhase": "Success",
        "componentKinds": [
            {
                "group": "apps",
                "kind": "Deployment"
            },
            {
                "group": "",
                "kind": "Service"
            },
            {
                "group": "",
                "kind": "ServiceAccount"
            }
        ],
        "descriptor": {
            "description": "A description of this application. A marketplace backend integration solution.",
            "type": "DoiT Easily",
            "version": "0.0.1"
        },
        "selector": {
            "matchLabels": {
                "app.kubernetes.io/name": "apptest-6h847sl3"
            }
        }
    },
    "status": {
        "components": [
            {
                "group": "apps",
                "kind": "Deployment",
                "name": "apptest-6h847sl3-processor",
                "status": "InProgress"
            },
            {
                "group": "apps",
                "kind": "Deployment",
                "name": "apptest-6h847sl3-server",
                "status": "InProgress"
            },
            {
                "kind": "Service",
                "name": "apptest-6h847sl3-api",
                "status": "Ready"
            },
            {
                "kind": "ServiceAccount",
                "name": "apptest-6h847sl3-deployer-sa",
                "status": "Ready"
            },
            {
                "kind": "ServiceAccount",
                "name": "apptest-6h847sl3-deploymentserviceaccount",
                "status": "Ready"
            }
        ],
        "componentsReady": "3/5",
        "conditions": [
            {
                "lastTransitionTime": "2022-04-22T16:52:25Z",
                "lastUpdateTime": "2022-04-22T16:52:25Z",
                "message": "2 components not ready",
                "reason": "ComponentsNotReady",
                "status": "False",
                "type": "Ready"
            },
            {
                "lastTransitionTime": "2022-04-22T16:51:58Z",
                "lastUpdateTime": "2022-04-22T16:51:58Z",
                "message": "No error seen",
                "reason": "NoError",
                "status": "False",
                "type": "Error"
            }
        ],
        "observedGeneration": 2
    }
}
+ wait_for_ready.py --name apptest-6h847sl3 --namespace apptest-6h847sl3 --timeout 300

INFO Wait 300.0 seconds for the application 'apptest-6h847sl3' to get into ready state
    kubectl get "applications.app.k8s.io/apptest-6h847sl3"
      --namespace="apptest-6h847sl3"
      --output=json
    
INFO Top level resources: 5
INFO Initialization: Found applications.app.k8s.io/apptest-6h847sl3 ready status to be True.
INFO Wait 30 seconds to make sure app stays in healthy state.
INFO Top level resources: 5
INFO Top level resources: 5
INFO Top level resources: 5
INFO Top level resources: 5
INFO Top level resources: 5
+ tester_manifest=/data/tester.yaml
+ [[ -e /data/tester.yaml ]]
+ cat /data/tester.yaml
apiVersion: v1
kind: Pod
metadata:
  annotations:
    marketplace.cloud.google.com/verification: test
  labels:
    app.kubernetes.io/name: apptest-6h847sl3
  name: apptest-6h847sl3-tester
  ownerReferences:
  - apiVersion: app.k8s.io/v1beta1
    blockOwnerDeletion: true
    kind: Application
    name: apptest-6h847sl3
    uid: a66a1df5-2d0c-486f-8fb4-467e7d149db3
spec:
  containers:
  - env:
    - name: namespace
      valueFrom:
        fieldRef:
          fieldPath: metadata.namespace
    - name: app_instance_name
      value: apptest-6h847sl3
    image: gcr.io/doit-public/doit-easily/tester:0.1
    imagePullPolicy: Always
    name: tester
    resources:
      requests:
        cpu: 250m
        ephemeral-storage: 1Gi
        memory: 1Gi
  restartPolicy: Never
  serviceAccountName: apptest-6h847sl3-deployer-sa
+ run_tester.py --namespace apptest-6h847sl3 --manifest /data/tester.yaml --timeout 300

        kubectl apply
        --namespace="apptest-6h847sl3"
        --filename="/data/tester.yaml"
        
INFO Reading /data/tester.yaml

          kubectl get "Pod/apptest-6h847sl3-tester"
          --namespace="apptest-6h847sl3"
          -o=json
          

          kubectl get "Pod/apptest-6h847sl3-tester"
          --namespace="apptest-6h847sl3"
          -o=json
          

          kubectl get "Pod/apptest-6h847sl3-tester"
          --namespace="apptest-6h847sl3"
          -o=json
          

          kubectl get "Pod/apptest-6h847sl3-tester"
          --namespace="apptest-6h847sl3"
          -o=json
          

          kubectl get "Pod/apptest-6h847sl3-tester"
          --namespace="apptest-6h847sl3"
          -o=json
          

          kubectl get "Pod/apptest-6h847sl3-tester"
          --namespace="apptest-6h847sl3"
          -o=json
          

          kubectl get "Pod/apptest-6h847sl3-tester"
          --namespace="apptest-6h847sl3"
          -o=json
          

          kubectl get "Pod/apptest-6h847sl3-tester"
          --namespace="apptest-6h847sl3"
          -o=json
          

          kubectl get "Pod/apptest-6h847sl3-tester"
          --namespace="apptest-6h847sl3"
          -o=json
          

          kubectl get "Pod/apptest-6h847sl3-tester"
          --namespace="apptest-6h847sl3"
          -o=json
          

          kubectl get "Pod/apptest-6h847sl3-tester"
          --namespace="apptest-6h847sl3"
          -o=json
          

          kubectl get "Pod/apptest-6h847sl3-tester"
          --namespace="apptest-6h847sl3"
          -o=json
          

          kubectl get "Pod/apptest-6h847sl3-tester"
          --namespace="apptest-6h847sl3"
          -o=json
          

          kubectl get "Pod/apptest-6h847sl3-tester"
          --namespace="apptest-6h847sl3"
          -o=json
          

          kubectl get "Pod/apptest-6h847sl3-tester"
          --namespace="apptest-6h847sl3"
          -o=json
          

          kubectl get "Pod/apptest-6h847sl3-tester"
          --namespace="apptest-6h847sl3"
          -o=json
          

          kubectl get "Pod/apptest-6h847sl3-tester"
          --namespace="apptest-6h847sl3"
          -o=json
          

          kubectl get "Pod/apptest-6h847sl3-tester"
          --namespace="apptest-6h847sl3"
          -o=json
          

          kubectl get "Pod/apptest-6h847sl3-tester"
          --namespace="apptest-6h847sl3"
          -o=json
          

          kubectl get "Pod/apptest-6h847sl3-tester"
          --namespace="apptest-6h847sl3"
          -o=json
          
kubectl logs Pod/apptest-6h847sl3-tester --namespace="apptest-6h847sl3"
result: 0
+ shopt -s nullglob
+ for test in /tests/*
+ testrunner -logtostderr --test_spec=/tests/basic-suite.yaml
I0422 16:54:43.603113       9 main.go:86] >>> Running /tests/basic-suite.yaml
I0422 16:54:43.604001       9 main.go:136]  >   0: API responds alive
I0422 16:54:43.635791       9 main.go:141]  PASSED
I0422 16:54:43.635808       9 main.go:117]  >> Summary: PASSED
I0422 16:54:43.635812       9 main.go:123]  >   0: API responds alive: PASSED
I0422 16:54:43.635817       9 main.go:97] >>> SUMMARY: All passed

Using /opt/kubectl/1.21/kubectl (server=1.21)


INFO SMOKE_TEST Tester 'Pod/apptest-6h847sl3-tester' succeeded.
+ clean_iam_resources.sh
+ [[ -z apptest-6h847sl3 ]]
+ [[ -z apptest-6h847sl3 ]]
+ kubectl delete --namespace=apptest-6h847sl3 ServiceAccount -l app.kubernetes.io/component=deployer.marketplace.cloud.google.com,app.kubernetes.io/name=apptest-6h847sl3 --ignore-not-found
Using /opt/kubectl/1.21/kubectl (server=1.21)
serviceaccount "apptest-6h847sl3-deployer-sa" deleted
+ trap - EXIT
INFO Stop the application
Using /opt/kubectl/default/kubectl (server=1.21)
application.app.k8s.io "apptest-6h847sl3" deleted
INFO Wait for the applications to be deleted
INFO Checking if applications.app.k8s.io were deleted
Using /opt/kubectl/default/kubectl (server=1.21)
INFO Wait for standard resources were deleted.
INFO Checking if all were deleted
Using /opt/kubectl/default/kubectl (server=1.21)
INFO Remaining: 1
INFO Pod/apptest-6h847sl3-processor-997c874b7-bbnhl
INFO Checking if all were deleted
Using /opt/kubectl/default/kubectl (server=1.21)
INFO Remaining: 1
INFO Pod/apptest-6h847sl3-processor-997c874b7-bbnhl
INFO Checking if all were deleted
Using /opt/kubectl/default/kubectl (server=1.21)
INFO Remaining: 1
INFO Pod/apptest-6h847sl3-processor-997c874b7-bbnhl
INFO Checking if all were deleted
Using /opt/kubectl/default/kubectl (server=1.21)
INFO Remaining: 1
INFO Pod/apptest-6h847sl3-processor-997c874b7-bbnhl
INFO Checking if all were deleted
Using /opt/kubectl/default/kubectl (server=1.21)
INFO Remaining: 1
INFO Pod/apptest-6h847sl3-processor-997c874b7-bbnhl
INFO Checking if all were deleted
Using /opt/kubectl/default/kubectl (server=1.21)
INFO Remaining: 1
INFO Pod/apptest-6h847sl3-processor-997c874b7-bbnhl
INFO Checking if all were deleted
Using /opt/kubectl/default/kubectl (server=1.21)
INFO Wait for service accounts to be deleted.
INFO Checking if serviceaccounts,roles,rolebindings were deleted
Using /opt/kubectl/default/kubectl (server=1.21)
INFO cleaning all resources.
INFO Collecting events for namespace "apptest-6h847sl3"
Using /opt/kubectl/default/kubectl (server=1.21)
LAST SEEN   TYPE      REASON              OBJECT                                            MESSAGE
3m36s       Normal    Scheduled           pod/apptest-6h847sl3-deployer-2z8wz               Successfully assigned apptest-6h847sl3/apptest-6h847sl3-deployer-2z8wz to gk3-mp-cluster1-nap-5vpr1bxz-ad980a8d-pbkw
3m34s       Normal    Pulling             pod/apptest-6h847sl3-deployer-2z8wz               Pulling image "gcr.io/doit-public/doit-easily/deployer:0.1"
3m34s       Normal    Pulled              pod/apptest-6h847sl3-deployer-2z8wz               Successfully pulled image "gcr.io/doit-public/doit-easily/deployer:0.1" in 121.740304ms
3m34s       Normal    Created             pod/apptest-6h847sl3-deployer-2z8wz               Created container deployer
3m33s       Normal    Started             pod/apptest-6h847sl3-deployer-2z8wz               Started container deployer
3m36s       Normal    SuccessfulCreate    job/apptest-6h847sl3-deployer                     Created pod: apptest-6h847sl3-deployer-2z8wz
59s         Normal    Completed           job/apptest-6h847sl3-deployer                     Job completed
3m21s       Normal    Scheduled           pod/apptest-6h847sl3-processor-997c874b7-bbnhl    Successfully assigned apptest-6h847sl3/apptest-6h847sl3-processor-997c874b7-bbnhl to gk3-mp-cluster1-nap-5vpr1bxz-2c498c0b-75d9
3m19s       Normal    Pulling             pod/apptest-6h847sl3-processor-997c874b7-bbnhl    Pulling image "gcr.io/doit-public/doit-easily/app:0.0.1"
3m19s       Normal    Pulled              pod/apptest-6h847sl3-processor-997c874b7-bbnhl    Successfully pulled image "gcr.io/doit-public/doit-easily/app:0.0.1" in 161.3016ms
3m19s       Normal    Created             pod/apptest-6h847sl3-processor-997c874b7-bbnhl    Created container apptest-6h847sl3-processor
3m18s       Normal    Started             pod/apptest-6h847sl3-processor-997c874b7-bbnhl    Started container apptest-6h847sl3-processor
55s         Normal    Killing             pod/apptest-6h847sl3-processor-997c874b7-bbnhl    Stopping container apptest-6h847sl3-processor
3m22s       Normal    SuccessfulCreate    replicaset/apptest-6h847sl3-processor-997c874b7   Created pod: apptest-6h847sl3-processor-997c874b7-bbnhl
3m22s       Normal    ScalingReplicaSet   deployment/apptest-6h847sl3-processor             Scaled up replica set apptest-6h847sl3-processor-997c874b7 to 1
3m22s       Normal    Scheduled           pod/apptest-6h847sl3-server-cfb77c9f9-bwgkq       Successfully assigned apptest-6h847sl3/apptest-6h847sl3-server-cfb77c9f9-bwgkq to gk3-mp-cluster1-nap-5vpr1bxz-ad980a8d-pbkw
3m19s       Normal    Pulled              pod/apptest-6h847sl3-server-cfb77c9f9-bwgkq       Container image "gcr.io/doit-public/doit-easily/app:0.0.1" already present on machine
3m19s       Normal    Created             pod/apptest-6h847sl3-server-cfb77c9f9-bwgkq       Created container apptest-6h847sl3-container
3m17s       Normal    Started             pod/apptest-6h847sl3-server-cfb77c9f9-bwgkq       Started container apptest-6h847sl3-container
55s         Normal    Killing             pod/apptest-6h847sl3-server-cfb77c9f9-bwgkq       Stopping container apptest-6h847sl3-container
3m22s       Normal    SuccessfulCreate    replicaset/apptest-6h847sl3-server-cfb77c9f9      Created pod: apptest-6h847sl3-server-cfb77c9f9-bwgkq
3m22s       Normal    ScalingReplicaSet   deployment/apptest-6h847sl3-server                Scaled up replica set apptest-6h847sl3-server-cfb77c9f9 to 1
2m34s       Warning   FailedScheduling    pod/apptest-6h847sl3-tester                       0/2 nodes are available: 1 Insufficient memory, 2 Insufficient cpu.
2m30s       Normal    TriggeredScaleUp    pod/apptest-6h847sl3-tester                       pod triggered scale-up: [{https://www.googleapis.com/compute/v1/projects/doit-easily-dev/zones/us-central1-a/instanceGroups/gk3-mp-cluster1-nap-5vpr1bxz-cdd6dcf5-grp 0->1 (max: 1000)}]
95s         Warning   FailedScheduling    pod/apptest-6h847sl3-tester                       0/3 nodes are available: 1 Insufficient memory, 1 node(s) had taint {node.kubernetes.io/not-ready: }, that the pod didn't tolerate, 2 Insufficient cpu.
85s         Normal    Scheduled           pod/apptest-6h847sl3-tester                       Successfully assigned apptest-6h847sl3/apptest-6h847sl3-tester to gk3-mp-cluster1-nap-5vpr1bxz-cdd6dcf5-rfb7
83s         Normal    Pulling             pod/apptest-6h847sl3-tester                       Pulling image "gcr.io/doit-public/doit-easily/tester:0.1"
68s         Normal    Pulled              pod/apptest-6h847sl3-tester                       Successfully pulled image "gcr.io/doit-public/doit-easily/tester:0.1" in 14.79423482s
65s         Normal    Created             pod/apptest-6h847sl3-tester                       Created container tester
64s         Normal    Started             pod/apptest-6h847sl3-tester                       Started container tester
Using /opt/kubectl/default/kubectl (server=1.21)
Using /opt/kubectl/default/kubectl (server=1.21)
INFO Deleting namespace "apptest-6h847sl3"
Using /opt/kubectl/default/kubectl (server=1.21)
apiVersion: v1
items: []
kind: List
metadata:
  resourceVersion: ""
  selfLink: ""
Using /opt/kubectl/default/kubectl (server=1.21)
namespace "apptest-6h847sl3" deleted
=== ERROR SUMMARY ===

Error events found in namespace "apptest-6h847sl3"
LAST SEEN   TYPE      REASON             OBJECT                        MESSAGE
2m36s       Warning   FailedScheduling   pod/apptest-6h847sl3-tester   0/2 nodes are available: 1 Insufficient memory, 2 Insufficient cpu.
97s         Warning   FailedScheduling   pod/apptest-6h847sl3-tester   0/3 nodes are available: 1 Insufficient memory, 1 node(s) had taint {node.kubernetes.io/not-ready: }, that the pod didn't tolerate, 2 Insufficient cpu.
=====================

=== VERIFICATION STATUS ===
PASSED
===========================
